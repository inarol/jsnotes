<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0,  minimum-scale=1.0, maximum-scale=1.0" />
    <title>promise-all</title>
    <link rel="stylesheet" href="./css/icon.css">
</head>

<body>
    <div id="log">
    </div>
</body>
<script>
var pokemons = [{
    name: "小火龙",
    icon: "pokemon-1"
}, {
    name: "杰尼龟",
    icon: "pokemon-2"
}, {
    name: "妙蛙种子",
    icon: "pokemon-3"
}, {
    name: "皮卡丘",
    icon: "pokemon-4"
}];
var printLog = function(log) {
    document.getElementById("log").innerHTML = document.getElementById("log").innerHTML + log + "<br /><br />";
};
var pokemonToHTML = function(pokemon) {
    return "<span class='" + pokemon.icon + "'></span>";
};
var p1 = new Promise(function(resolve, reject) {
    setTimeout(function() {
        var value = Math.random();
        var pokemon = pokemons[0];
        if (value > 0.5) {
            resolve(pokemon);
        } else {
            reject(pokemon);
        }
    }, Math.round(Math.random() * 9 + 1) * 100);

});
var p2 = new Promise(function(resolve, reject) {
    setTimeout(function() {
        var value = Math.random();
        var pokemon = pokemons[1];
        if (value > 0.2) {
            resolve(pokemon);
        } else {
            reject(pokemon);
        }
    }, Math.round(Math.random() * 9 + 1) * 100);
});
var p3 = new Promise(function(resolve, reject) {
    setTimeout(function() {
        var value = Math.random();
        var pokemon = pokemons[2];
        if (value > 0.2) {
            resolve(pokemon);
        } else {
            reject(pokemon);
        }
    }, Math.round(Math.random() * 9 + 1) * 100);
});
var p4 = new Promise(function(resolve, reject) {
    setTimeout(function() {
        var value = Math.random();
        var pokemon = pokemons[3];
        if (value > 0.2) {
            resolve(pokemon);
        } else {
            reject(pokemon);
        }
    }, Math.round(Math.random() * 9 + 1) * 100);
});
var promise = Promise.race([p1, p2, p3, p4]);
promise.then(function onResolved(pokemon) {
    printLog("恭喜你！你抓到了" + pokemonToHTML(pokemon) + "！！！");
}).catch(function onRejected(pokemon) {
    printLog("游戏失败！" + pokemonToHTML(pokemon) + "溜走啦~~");
});
</script>

</html>
